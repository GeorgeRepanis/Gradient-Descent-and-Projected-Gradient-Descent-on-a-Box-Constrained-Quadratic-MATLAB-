%% ΘΕΜΑ 2 - Μέθοδος Μέγιστης Καθόδου με Προβολή
clear; clc; close all;

% Αντικειμενική συνάρτηση & gradient
f  = @(x) (1/3)*x(1).^2 + 3*x(2).^2;
gf = @(x) [ (2/3)*x(1); 6*x(2) ];

% Προβολή στο κουτί X: -10<=x1<=5, -8<=x2<=12
projX = @(z) [ ...
    min(5, max(-10, z(1))); ...
    min(12, max(-8,  z(2))) ];

% Παράμετροι μεθόδου
s       = 5;          % μήκος "προ-βήματος"
gamma   = 0.5;        % τελικό βήμα πάνω στη διεύθυνση προβολής
epsilon = 1e-2;       % ακρίβεια (κριτήριο: ||x_k|| <= epsilon)
kmax    = 300;        % μέγιστος αριθμός επαναλήψεων (ασφάλεια)

% Αρχικό σημείο
x0 = [5; -5];

% Αρχικοποίηση
xk = x0;
k  = 0;

F_hist = f(xk);       % ιστορικό f(x_k)

% Επανάληψη Μέγιστης Καθόδου με Προβολή
while norm(xk) > epsilon && k < kmax
    gk = gf(xk);          % gradient στο x_k

    % 1) Προ-βήμα καθόδου
    yk = xk - s * gk;

    % 2) Προβολή στο X
    zk = projX(yk);

    % 3) Διεύθυνση
    dk = zk - xk;

    % 4) Τελικό βήμα
    xk = xk + gamma * dk;

    k = k + 1;

    % Αποθήκευση ιστορικού
    F_hist(k+1) = f(xk);

    if ~isfinite(F_hist(k+1))
        break;      % σταμάτα αν "σκάσει" αριθμητικά
    end
end

% -------- ΓΡΑΦΗΜΑ ΓΙΑ REPORT (πρώτες 50 επαναλήψεις) --------
maxPlotK = min(k, 50);                % δείξε μέχρι 50 επαναλήψεις
iters = 0:maxPlotK;

figure;
plot(iters, F_hist(1:maxPlotK+1), 'o-','LineWidth',1.5);
xlabel('Αριθμός επαναλήψεων k');      % όνομα άξονα x
ylabel('τιμή f(x_k)');                % όνομα άξονα y
title('Σύγκλιση της f(x_k) για Μέθοδο Καθόδου με Προβολή (Θέμα 2)'); % τίτλος
grid on;
